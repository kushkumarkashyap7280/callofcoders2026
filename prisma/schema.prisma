// prisma/schema.prisma
// Define your database models

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model Course {
  id           String   @id @default(uuid())
  slug         String   @unique // e.g. "nextjs-mastery"
  title        String
  description  String   @db.Text // Allow longer descriptions
  imageUrl     String?  @map("img_url") // Maps to your preferred column name
  externalLink String?  @map("external_link")
  tags         String[] // PostgreSQL natively supports arrays!
  isPublished  Boolean  @default(false)
  isFeatured   Boolean  @default(false) @map("is_featured") // Featured courses
  instructor   String?  // Instructor name
  level        String?  @default("Beginner") // Beginner, Intermediate, Advanced
  duration     String?  // e.g., "4 weeks", "10 hours"
  price        Float?   @default(0) // For future paid courses (0 = free)
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  lessons      Lesson[]
  enrollments  Enrollment[]

  @@map("courses") // table name in DB
}

model Lesson {
  id          String   @id @default(uuid())
  slug        String   // e.g. "setup-environment"
  title       String   // Needed for the sidebar
  description String?  // Short description for lesson overview
  sequenceNo  Int      @map("sequence_no")
  content     String   @db.Text // @db.Text is needed for long MDX strings
  duration    String?  // e.g., "15 min", "30 min"
  isPreview   Boolean  @default(false) @map("is_preview") // Free preview lessons
  videoUrl    String?  @map("video_url") // Optional video URL
  
  courseId    String   @map("course_id")
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  
  completions LessonCompletion[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Unique constraint: A slug must be unique *within* a specific course, 
  // but two different courses can both have an "introduction" lesson.
  @@unique([courseId, slug])
  @@map("lessons")
  }

model User {
  id                String    @id @default(uuid())
  email             String    @unique
  username          String?   @unique // Unique username for profile URL
  name              String?
  googleId          String?   @map("google_id") @unique
  passwordHash      String    @map("password_hash")
  isAdmin           Boolean   @default(false) @map("is_admin")  
  profileImageUrl   String?   @map("profile_image_url") // Cloudinary image URL
  cloudinaryImageId String?   @map("cloudinary_image_id") // Cloudinary public ID for deletion
  metadata          Json?     // Public profile metadata (bio, social links, etc.)
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt      @map("updated_at")  
  enrollments       Enrollment[] 
  @@map("users")
}

model Enrollment {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  courseId        String    @map("course_id")
  enrolledAt      DateTime  @default(now()) @map("enrolled_at")
  lastAccessedAt  DateTime? @map("last_accessed_at")
  currentLessonId String?   @map("current_lesson_id") // Track progress
  isCompleted     Boolean   @default(false) @map("is_completed")
  completedAt     DateTime? @map("completed_at") // When course was completed
  progress        Int       @default(0) // Percentage (0-100)
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  course          Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lessonCompletions LessonCompletion[]
  
  @@unique([userId, courseId]) // A user can only enroll once per course
  @@map("enrollments")
}

model LessonCompletion {
  id              String    @id @default(uuid())
  enrollmentId    String    @map("enrollment_id")
  lessonId        String    @map("lesson_id")
  completedAt     DateTime  @default(now()) @map("completed_at")
  
  enrollment      Enrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  lesson          Lesson     @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  
  @@unique([enrollmentId, lessonId]) // Can't complete same lesson twice in same enrollment
  @@map("lesson_completions")
}

model blogs {
  id          String   @id @default(uuid())
  slug        String   @unique
  title       String
  content     String   @db.Text
  author      String
  isPublished Boolean  @default(false) @map("is_published")
  publishedAt DateTime? @map("published_at")

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt      @map("updated_at")

  @@map("blogs")
}

enum OtpType {
  SIGNUP
  RESET
}

enum OtpStatus {
  SENT
  VERIFIED
}

model Otp {
  email      String    @id
  otpType    OtpType   @map("otp_type")
  status     OtpStatus @default(SENT)
  otpCode    String    @map("otp_code")
  createdAt  DateTime  @default(now()) @map("created_at")

  @@map("otp")
}

model OtpSession {
  email      String   @id
  createdAt  DateTime @default(now()) @map("created_at")
  attempts   Int      @default(0) // Track number of attempts
  
  @@map("otp_session")
}


// schema.prisma

model Project {
  id              Int      @id @default(autoincrement()) // project_id
  title           String
  desc            String
  createdAt       DateTime @default(now()) // created_at
  technologies    String[] // Array of strings (e.g., ["React", "Node"])
  imgUrl          String?  // img_url (Optional)
  projectLiveLink String?  // project_live_link (Optional)
  sourceCodeLink  String?  // source_code_link (Optional)
  isPublished     Boolean  @default(false)
  sequenceNo      Int      @default(0) // sequence_no

  @@map("projects")
}

model Education {
  id                  Int      @id @default(autoincrement()) // edu_id
  title               String   // Degree or Certificate name
  desc                String?
  createdAt           DateTime @default(now()) // created_at
  cgpa                String?  // String allows "8.5/10" or "3.8" formats
  institutionLogoLink String?  // institution_logo_link
  institutionName     String   // institution_name
  institutionLink     String?  // institution_link
  fromTo              String   // from_to (e.g., "2020-2024")
  isPublished         Boolean  @default(false)
  sequenceNo          Int      @default(0) // sequence_no

  @@map("education")
}



